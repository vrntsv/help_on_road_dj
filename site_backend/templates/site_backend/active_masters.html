{% extends 'site_backend/base.html' %}
{% load static %}
{% load djutils %}
{% load cache %}
{% cache 500 active_masters %}

{% block content %}
<div class="container-fluid">
    <!-- DataTales -->
    <div class="card shadow mb-4">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                    <thead>
                    <tr>
                        <!--
                        –±–∞–ª–∞–Ω—Å 1000 / 500
                        —Å–¥–µ–ª–æ–∫: 10/5/3 –≤—ã–ø–æ–ª/—Å–æ—Ä–≤–∞–Ω–æ/–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–æ
                              üëë - —ç–∫—Å–∫–ª—é–∑–∏–≤
                        ‚úÖ / ‚ùå - –Ω–∞ –ª–∏–Ω–∏–∏
                              ü•á - —É—Å–ª—É–≥–∞ —Å–∞–º—ã–π –ø–µ—Ä–≤—ã–π
                        -->
                        <th>–ì–æ—Ä–æ–¥</th>
                        <th>–§–ò–û</th>
                        <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                        <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
                        <th>–ë–∞–ª–∞–Ω—Å</th>
                        <th>–î–æ—Ö–æ–¥ –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª–∞–º</th>
                        <th>–°–¥–µ–ª–æ–∫</th>
                        <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                    </tr>
                </thead>
                    <tbody>
                        {% for emp in active_masters %}
                            <tr>
                                <td>{{ emp|get_value_from_dict:'name_city' }}</td>
                                <td>
                                    {% if emp|get_value_from_dict:'exclusive' == 1 %} üëë {% endif %}
                                    <a href="{% url "site_backend:master_card_url"  emp|get_value_from_dict:'id' %}">
                                        {{emp|get_value_from_dict:'full_name'}}
                                    </a>
                                    {% if emp|get_value_from_dict:'active' == 1 %} ‚úÖ {% else %} ‚ùå {% endif %}
                                    {% if emp|get_value_from_dict:'very_first' %} ü•á {% endif %}
                                </td>
                                <td>{{emp|get_value_from_dict:'phone'}}</td>
                                <td>{{emp|get_value_from_dict:'reg_date'}}</td>
                                <td>{{emp|get_value_from_dict:'balance'}} ‚ÇΩ<br>{{emp|get_value_from_dict:'bonuses'}} ‚ÇΩ</td>
                                <td>{{emp|get_value_from_dict:'referal_income'}}‚ÇΩ</td>
                                <!-- –≤—ã–≤–æ–¥–∏ —Å—é–¥–∞ –∫–æ—ç—Ñ–∏—Ü–∏–µ–Ω—Ç (80%) —Ñ–æ—Ä–º—É–ª–∞ : k = m/N
                                N - –æ–±—â–µ–µ —á–∏—Å–ª–æ —Å–¥–µ–ª–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                                m - –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
                                k - –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç  -->
                                <td data-toggle="tooltip" data-placement="top" title="{{emp|get_value_from_dict:'closed_deals_count'}}/{{emp|get_value_from_dict:'droped_deals_count'}}/{{emp|get_value_from_dict:'proped_deals_count'}}">
                                                80%
                                </td>
                                <td>
                                    <button  type="submit" data-toggle="modal" data-target="#editMenu_{{ emp|get_value_from_dict:'id' }}" class="col my-auto btn bg-gray-200">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<!-- /.container-fluid -->

{% for emp in active_masters %}
    <div class="modal fade" id="editMenu_{{ emp|get_value_from_dict:'id' }}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">√ó</span>
                    </button>
                </div>
                <form action="{% url 'site_backend:edit_users_data' emp|get_value_from_dict:'id' %}" method="post">
                    {% csrf_token %}
                    <div class="modal-body">
                        {% if emp|get_value_from_dict:'exlusive' %}üëë{% endif %}
                        <input class="form-control" type="text" name="full_name" value="{{ emp|get_value_from_dict:'full_name' }}" placeholder="–ò–º—è"><br>
                        <input class="form-control" type="text" name="phone" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞" value="{{ emp|get_value_from_dict:'phone' }}"><br>
                        <p>–°–ø–∏—Å–æ–∫ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π:</p>
                        <div class="container" >
                            {% for wt in work_types %}
                                {% if wt|get_value_from_dict:'id' in emp|get_value_from_dict:'emp_wt' %}
                                    <input class="form-check-input" type="checkbox" value="{{ wt|get_value_from_dict:'id' }}" name="emp_wt" id="defaultCheck1" checked>
                                    <label class="form-check-label" for="defaultCheck1" >
                                        {{ wt|get_value_from_dict:'type' }}
                                    </label><br>
                                {% else %}
                                    <input class="form-check-input" type="checkbox" value="{{ wt|get_value_from_dict:'id' }}" name="emp_wt" id="defaultCheck1" >
                                    <label class="form-check-label" for="defaultCheck1">
                                        {{ wt|get_value_from_dict:'type' }}
                                    </label><br>
                                {% endif %}
                            {% endfor %}<br><br>
                            {% if emp|get_value_from_dict:'exclusive' %}
                                <input type="checkbox" class="custom-control-input" id="excl_type" value="on" name="excl_type" checked >
                                <label class="custom-control-label" for="excl_type"> –°—Ç–∞—Ç—É—Å —É–Ω–∏–≤–µ—Ä—Å–∞–ª–∞ </label>
                            {% else %}
                                <input type="checkbox" class="custom-control-input" id="excl_type" value="off" name="excl_type"  >
                                <label class="custom-control-label" for="excl_type"> –°—Ç–∞—Ç—É—Å —É–Ω–∏–≤–µ—Ä—Å–∞–ª–∞ </label>
                            {% endif %}
                        </div>
                        <br><br>
                        <div class="container">
                            <div class="row">
                                <button class="btn btn-danger col-6" type="button" name="block" data-dismiss="modal" >
                                    –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
                                </button>
                                <button class="btn btn-info col-6" type="button" name="freeze" data-dismiss="modal">
                                    –ó–∞–º–æ—Ä–æ–∑–∏—Ç—å
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                      <button class="btn btn-success" type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                      <button class="btn btn-secondary" type="submit" data-dismiss="modal" aria-label="Close">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </form>

            </div>
        </div>
    </div>
{% endfor %}
{% endblock %}
{% endcache %}

